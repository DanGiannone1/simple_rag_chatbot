import{r as p,j as r,T as f,S as D,G as A,P as w,B as P,a as z,b as L,c as N,A as q,M as F,d as V,C as W}from"./mantine-keBO8nUF.js";import{a as H}from"./react-core-CvRECnwm.js";import{I as M,a as G,b as J}from"./icons-Cj-4ajAR.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var y={},R;function K(){if(R)return y;R=1;var e=H();return y.createRoot=e.createRoot,y.hydrateRoot=e.hydrateRoot,y}var Q=K();const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function X(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}let S;const Y=new Uint8Array(16);function Z(){if(!S){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");S=crypto.getRandomValues.bind(crypto)}return S(Y)}const _=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),k={randomUUID:_};function T(e,t,s){if(k.randomUUID&&!t&&!e)return k.randomUUID();e=e||{};const o=e.random||(e.rng||Z)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,X(o)}function $(){const[e,t]=p.useState([]),[s,o]=p.useState(!1),[n,i]=p.useState(null),l=p.useCallback(async h=>{var C;if(s)return;const v={id:T(),text:h,isBot:!1,timestamp:new Date};t(c=>[...c,v]);const g=T(),U={id:g,text:"",isBot:!0,timestamp:new Date,isComplete:!1};t(c=>[...c,U]),i(g),o(!0);try{const c=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:h})});if(!c.ok)throw new Error("Failed to get response");const b=(C=c.body)==null?void 0:C.getReader();if(!b)throw new Error("No reader available");let x=[],I="";for(;;){const{done:B,value:O}=await b.read();if(B)break;const E=new TextDecoder().decode(O).split(`
`);for(const j of E)if(j.startsWith("data: ")){if(j.includes("[DONE]")){t(d=>d.map(u=>u.id===g?{...u,isComplete:!0}:u)),o(!1),i(null);break}try{const d=JSON.parse(j.slice(5));d.citations&&(x=d.citations,t(u=>u.map(m=>m.id===g?{...m,citations:x}:m))),d.chunk&&(I+=d.chunk,t(u=>u.map(m=>m.id===g?{...m,text:I}:m)))}catch(d){console.error("Failed to parse chunk:",d)}}}}catch(c){console.error("Chat error:",c),t(b=>b.map(x=>x.id===g?{...x,text:"Error: Failed to get response",isComplete:!0}:x))}finally{o(!1),i(null)}},[s]);return{messages:e,isStreaming:s,currentStreamId:n,sendMessage:l}}function ee({message:e}){const t=p.useMemo(()=>!e.isBot||!e.text?[{type:"text",content:e.text}]:e.text.split(/(\[References:.*?\]|\[\d+\])/gs).map(o=>{var i;const n=o.match(/\[(\d+)\]/);if(n){const l=parseInt(n[1]),h=(i=e.citations)==null?void 0:i.find(v=>v.id===l);return{type:"citation",content:o,citation:h}}return o.startsWith("References:")?{type:"references",content:o}:{type:"text",content:o}}),[e.text,e.citations,e.isBot]);return r.jsx(f,{component:"div",style:{whiteSpace:"pre-wrap",lineHeight:1.6,color:"var(--text-bright)"},children:t.map((s,o)=>s.type==="citation"?r.jsx(f,{component:"span",style:{color:"var(--mantine-color-blue-filled)",cursor:s.citation?"pointer":"default",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:500},children:s.content},o):s.type==="references"?r.jsx(f,{component:"div",style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid var(--border-color)"},children:s.content},o):r.jsx("span",{children:s.content},o))})}function te({message:e}){const t=e.isBot;return r.jsxs(D,{gap:4,align:t?"flex-start":"flex-end",style:{padding:"0.5rem 1rem",maxWidth:"85%",alignSelf:t?"flex-start":"flex-end"},children:[r.jsxs(A,{align:"flex-start",style:{backgroundColor:t?"var(--message-bot-bg)":void 0,borderRadius:"8px",gap:t?"1rem":"0.5rem",flexDirection:t?"row":"row-reverse"},children:[r.jsx("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%",backgroundColor:t?"var(--icon-bg)":"var(--message-user-bg)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t?r.jsx(M,{style:{width:"calc(1.5rem * var(--mantine-scale))",height:"calc(1.5rem * var(--mantine-scale))",color:"var(--mantine-color-blue-filled)"}}):r.jsx(G,{style:{width:"calc(1.5rem * var(--mantine-scale))",height:"calc(1.5rem * var(--mantine-scale))",color:"white"}})}),r.jsx(w,{shadow:"sm",p:"lg",style:{flex:1,backgroundColor:t?"var(--container-bg)":"var(--message-user-bg)",color:t?"var(--text-bright)":"white",border:t?"1px solid var(--border-color)":"none"},radius:"md",children:r.jsx(ee,{message:e})})]}),r.jsx(f,{size:"xs",c:"dimmed",style:{marginLeft:t?"3.5rem":"0",marginRight:t?"0":"3.5rem"},children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}function re(){return r.jsxs(P,{style:{textAlign:"center",padding:"4rem 1rem",color:"var(--text-secondary)"},children:[r.jsx(M,{size:48,style:{marginBottom:"1rem",opacity:.5}}),r.jsx(f,{size:"lg",children:"Start a conversation..."}),r.jsx(f,{size:"sm",c:"dimmed",children:"Type a message below to begin"})]})}function oe(){const{messages:e,isStreaming:t,sendMessage:s}=$(),[o,n]=p.useState(""),i=async l=>{if(l.preventDefault(),!o.trim()||t)return;const h=o.trim();n(""),await s(h)};return r.jsxs(w,{style:{height:"100%",backgroundColor:"var(--container-bg)",border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",overflow:"hidden"},radius:"lg",shadow:"md",children:[r.jsx(z,{order:2,ta:"center",py:"sm",style:{borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--header-bg)",color:"var(--text-bright)"},children:"AI Chat Assistant"}),r.jsx(L,{flex:1,type:"hover",offsetScrollbars:!0,scrollbarSize:8,style:{backgroundColor:"var(--chat-bg)",width:"100%"},children:r.jsx(D,{gap:"md",p:"md",style:{width:"100%"},children:e.length===0?r.jsx(re,{}):e.map(l=>r.jsx(te,{message:l},l.id))})}),r.jsx(w,{p:"md",style:{borderTop:"1px solid var(--border-color)",backgroundColor:"var(--input-bg)"},children:r.jsx("form",{onSubmit:i,children:r.jsx(N,{placeholder:"Type your message...",value:o,onChange:l=>n(l.target.value),disabled:t,size:"lg",radius:"xl",styles:{input:{backgroundColor:"var(--container-bg)",border:"1px solid var(--border-color)","&:focus":{borderColor:"var(--mantine-color-blue-filled)"},fontSize:"1rem",padding:"1.2rem",height:"auto",paddingRight:"3.5rem",color:"var(--text-bright)","&::placeholder":{color:"var(--text-secondary)"}}},rightSection:r.jsx(q,{size:"lg",radius:"xl",color:"blue",variant:"subtle",type:"submit",disabled:!o.trim()||t,style:{backgroundColor:o.trim()?"var(--mantine-color-blue-filled)":"transparent",color:o.trim()?"white":"var(--mantine-color-blue-filled)",transition:"all 0.2s ease","&:hover":{backgroundColor:o.trim()?"var(--mantine-color-blue-filled-hover)":"var(--mantine-color-blue-light)"}},children:r.jsx(J,{style:{width:"1.2rem",height:"1.2rem"}})})})})})]})}function ne(){return r.jsx(F,{defaultColorScheme:"dark",children:r.jsx(V,{style:{backgroundColor:"var(--app-bg)",minHeight:"100vh"},children:r.jsx(W,{size:"md",h:"100vh",p:"md",style:{display:"flex",flexDirection:"column"},children:r.jsx(oe,{})})})})}Q.createRoot(document.getElementById("root")).render(r.jsx(p.StrictMode,{children:r.jsx(ne,{})}));
